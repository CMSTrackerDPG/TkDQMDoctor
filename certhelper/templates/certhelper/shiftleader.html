{% extends 'certhelper/base.html' %}

{% block style %}
    {% load static %}
    <link rel="stylesheet" href="{% static "certhelper/css/shiftleader.css" %}" type="text/css">
    <link rel="stylesheet" href="{% static "certhelper/css/runinfo_table.css" %}" type="text/css">
{% endblock style %}
{% block content %}
    {% load render_table from django_tables2 %}
    {% load bootstrap3 %}

    <div class="container-fluid">
        <h1 align="center">Shift Leader View</h1>

        {% include "certhelper/components/menu.html" %}
        <div class="container">
            {% if filter %}
                {% include "certhelper/components/filter.html" %}
            {% else %}
                <div class="alert alert-danger" role="alert">No Filter found.</div>
            {% endif %}
        </div>
        <ul class="nav nav-tabs">
            <li><a data-toggle="tab" href="#runtable">Certified Runs</a></li>
            <li><a data-toggle="tab" href="#overview">Overview</a></li>
            <li><a data-toggle="tab" href="#deleted-runs">Deleted Certifications</a></li>
            <li><a data-toggle="tab" href="#summary">Summary</a></li>
            <li class="active"><a data-toggle="tab" href="#shiftleader-report">Shift Leader Report</a></li>
        </ul>
        <div class="tab-content">
            <div id="runtable" class="tab-pane fade">
                <h3>List of Certified Runs</h3>
                {% if table %}
                    {% render_table table 'django_tables2/bootstrap.html' %}
                {% else %}
                    <div class="alert alert-danger" role="alert">No Table found.</div>
                {% endif %}
            </div>

            <div id="overview" class="tab-pane fade">
                {% if filter.qs %}
                    {% include "certhelper/components/overview.html" %}
                {% else %}
                    <div class="alert alert-danger" role="alert">
                        No runs have been certified in the specified filter criteria.
                    </div>
                {% endif %}
            </div>

            <div id="deleted-runs" class="tab-pane fade">
                <h3>List of deleted certified runs</h3>
                {% if deleted_runs %}
                    {% render_table deleted_runs 'django_tables2/bootstrap.html' %}
                {% else %}
                    <div class="alert alert-danger" role="alert">No Table found.</div>
                {% endif %}
            </div>


            <div id="summary" class="tab-pane fade">
                <h3>Summary</h3>
                {% if summary %}
                    {% include "certhelper/components/summary.html" %}
                {% else %}
                    <div class="alert alert-danger" role="alert">No Summary found.</div>
                {% endif %}
            </div>

            <div id="shiftleader-report" class="tab-pane fade in active">
                <h3>Shift Leader Report</h3>
                {% if slreport %}
                    {% include "certhelper/components/shift-leader-report.html" %}
                {% else %}
                    <div class="alert alert-danger" role="alert">No Shiftleader Report found.</div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock content %}


{% block script %}
    {% load static %}
    <script src="{% static "certhelper/js/shiftleader.js" %}"></script>
    <script src="{% static "certhelper/js/restore_selected_tabs.js" %}"></script>
    <script src="{% static "certhelper/js/filter.js" %}"></script>
    <script src="{% static "certhelper/js/runinfo_table.js" %}"></script>
    <script>
        {% if global_preferences.shiftleader__popup_enabled %}
            const popupTimeInMilliseconds = 1000 * {{ global_preferences.shiftleader__popup_time_period }};
            setTimeout(periodicallyPopupShiftleaderNotification,  popupTimeInMilliseconds);
            /*
            Pops up a alert box with text set in the global_preferences.shiftleader__popup_text.
            Will be called periodically (every shiftleader__popup_interval seconds) if the
            global_preferences.shiftleader__popup_enabled is set to true.

            This should help shift leader to remind them every now and them to do certain
            tasks (like daily checks).

            Leave this function here, since outsourcing it to a dedicated .js file would
            cause caching and you are not enable to have access to the global_preference
            */
            function periodicallyPopupShiftleaderNotification(){
                alert("{{ global_preferences.shiftleader__popup_text }}");
                setTimeout(periodicallyPopupShiftleaderNotification,  popupTimeInMilliseconds);
            }
        {% endif %}
    </script>
    <script>
        $(document).ready(function () {
            $("#sl-filter-form").submit(function () {
                var form = $(this);
                ignore_unwanted_filters(form);
                simplify_date_filter_parameters(form); // shortens date GET parameters in URL
                disable_empty_filter_fields(form); // simpliflies URL alot by removing unused fields
                return true; // ensure form still submits
            });

            $(".ignore-other-filter-checkbox").change(function(){
                if ($(this).is(":checked")){
                    uncheck_all_ignore_other_filter_checkboxes();
                    $(this).prop("checked", true);
                }

            });

            $("#id_run_number__in").css("width", "525px");

            $("#id_run_number__in").change(function(){
                console.log("changing" + $(this).val());
                let run_numbers_list = $(this).val();
                console.log("new" + run_numbers_list);
                run_numbers_list = run_numbers_list.replace(/[^0-9]/gmi, " ");
                run_numbers_list = run_numbers_list.replace(/\s+/g,' ');
                run_numbers_list = run_numbers_list.replace(/\s+/g,', ');

                console.log("new" + run_numbers_list);
                $(this).val(run_numbers_list);
                console.log("changed" + $(this).val());
            });

            colorize_components();
        });
    </script>
{% endblock script %}