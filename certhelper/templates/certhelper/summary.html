{% load static %}
<script src="{% static "certhelper/jquery/jquery.min.js" %}"></script>
<script src="{% static "certhelper/bootstrap/js/bootstrap.min.js" %}"></script>
<script src="{% static "certhelper/ascii-table/ascii-table.min.js" %}"></script>
<link rel="stylesheet" href="{% static "certhelper/bootstrap/css/bootstrap.min.css" %}">

<h1 align="center">Summary</h1>
<a href="{% url 'certhelper:list' %}" class="btn btn-link"><span class="glyphicon glyphicon-home"></span> Back to overview</a>

{% regroup sorted_by_type by type_id as type_list %}

{% regroup sums by type_id as sums_regroup %}
{% regroup tkmap by type_id as tkmap_regroup %}
{% regroup certified by type_id as certified_regroup %}

<pre>
=============Reference Runs===============
{% for ref in refs%}{{ref}}
{% endfor %}
=============Runs Checked================
<script>
    {% for type_id in type_list%}

    var table = new AsciiTable()
    table.setHeading("Run", "Reference Run","Number of LS", "Int. Luminosity", "Pixel", "Strip", "Tracking", "Comment")
    
    {% for item in type_id.list %}
        {% if forloop.first %}
            document.write("Type {{ forloop.parentloop.counter }}: {{item.type}}\n")
        {% endif %}

    table.addRow('{{ item.run_number }}',
                '{{ item.reference.reference_run }}',
                '{{ item.number_of_ls }}',
                '{{ item.int_luminosity }}',
                '{{ item.pixel }}',
                '{{ item.sistrip }}',
                '{{ item.tracking }}',
                '{{item.comment}}')

    {% endfor %}    
    document.write(table.toString())
    document.write("\n\n")
{% endfor %}  
</script>
=============Tracker Maps=================
{% for t in tkmap_regroup%}
Type {{forloop.counter}}: {% regroup t.list by trackermap as tmpi %}
{% for a in tmpi%} {% if a.grouper == "Exists" %}Produced{%else%}Todo    {%endif%}: {% for item in a.list %}{{item.run_number}}  {% endfor %}
{% endfor %}{% endfor %}
=============HDQM Trends==================
=============Special Comments=============

    -> !!! WRITE STUFF HERE !!! <-

=============Certified Runs===============
{% for t in certified_regroup%}
Type {{forloop.counter}}: {% regroup t.list by good as tmpi %}
{% for a in tmpi%} {%if a.grouper%}Good{%else%}Bad {%endif%}: {% for item in a.list %}{{item.run_number}}  {% endfor %}
{% endfor %}{% endfor %}
====================Sums==================
<script>
{% for t in sums_regroup%}
    var table = new AsciiTable()
    {% for item in t.list %}
    {%if forloop.first%}     table.setHeading("Type {{forloop.parentloop.counter}}", "Sum of LS", "Sum of int. luminosity"){%endif%}
    table.addRow('{% if item.good %}Good{%else%}Bad{%endif%}','{{item.sum_number_of_ls}}', '{{item.sum_int_luminosity}}')
    {% endfor %}
    document.write(table.toString() + '\n')
{% endfor %}
</script>
 
</pre>